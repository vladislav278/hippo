{% extends 'base.html' %}
{% load static %}

{% block title %}Регистрация - {{ block.super }}{% endblock %}

{% block content %}
<div class="container">
    <div class="register-container">
        <div class="register-card">
            <h1>Регистрация врача</h1>
            <p class="register-subtitle">Создайте аккаунт для доступа к платформе</p>
            
            {% if errors.general %}
                <div class="alert alert-error">
                    {{ errors.general }}
                </div>
            {% endif %}
            
            <form method="post" class="register-form">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-control {% if errors.email %}error{% endif %}"
                        value="{{ form_data.email|default:'' }}"
                        required
                    >
                    {% if errors.email %}
                        <span class="error-message">{{ errors.email }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="username">Имя пользователя *</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="form-control {% if errors.username %}error{% endif %}"
                        value="{{ form_data.username|default:'' }}"
                        required
                    >
                    {% if errors.username %}
                        <span class="error-message">{{ errors.username }}</span>
                    {% endif %}
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="last_name">Фамилия *</label>
                            <input 
                                type="text" 
                                id="last_name" 
                                name="last_name" 
                                class="form-control {% if errors.last_name %}error{% endif %}"
                                value="{{ form_data.last_name|default:'' }}"
                                required
                            >
                            {% if errors.last_name %}
                                <span class="error-message">{{ errors.last_name }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="first_name">Имя *</label>
                            <input 
                                type="text" 
                                id="first_name" 
                                name="first_name" 
                                class="form-control {% if errors.first_name %}error{% endif %}"
                                value="{{ form_data.first_name|default:'' }}"
                                required
                            >
                            {% if errors.first_name %}
                                <span class="error-message">{{ errors.first_name }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="patronymic">Отчество</label>
                            <input 
                                type="text" 
                                id="patronymic" 
                                name="patronymic" 
                                class="form-control {% if errors.patronymic %}error{% endif %}"
                                value="{{ form_data.patronymic|default:'' }}"
                            >
                            {% if errors.patronymic %}
                                <span class="error-message">{{ errors.patronymic }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="specialty">Специализация *</label>
                    <select 
                        id="specialty" 
                        name="specialty" 
                        class="form-control {% if errors.specialty %}error{% endif %}"
                        required
                    >
                        <option value="">-- Выберите специализацию --</option>
                        <option value="Кардиолог" {% if form_data.specialty == 'Кардиолог' %}selected{% endif %}>Кардиолог</option>
                        <option value="Невролог" {% if form_data.specialty == 'Невролог' %}selected{% endif %}>Невролог</option>
                        <option value="Пульмонолог" {% if form_data.specialty == 'Пульмонолог' %}selected{% endif %}>Пульмонолог</option>
                        <option value="Анестезиолог-реаниматолог" {% if form_data.specialty == 'Анестезиолог-реаниматолог' %}selected{% endif %}>Анестезиолог-реаниматолог</option>
                        <option value="Рентгенолог" {% if form_data.specialty == 'Рентгенолог' %}selected{% endif %}>Рентгенолог</option>
                        <option value="Гастроэнтеролог" {% if form_data.specialty == 'Гастроэнтеролог' %}selected{% endif %}>Гастроэнтеролог</option>
                        <option value="Хирург" {% if form_data.specialty == 'Хирург' %}selected{% endif %}>Хирург</option>
                        <option value="Нефролог" {% if form_data.specialty == 'Нефролог' %}selected{% endif %}>Нефролог</option>
                        <option value="Уролог" {% if form_data.specialty == 'Уролог' %}selected{% endif %}>Уролог</option>
                        <option value="ЛОР" {% if form_data.specialty == 'ЛОР' %}selected{% endif %}>ЛОР</option>
                    </select>
                    {% if errors.specialty %}
                        <span class="error-message">{{ errors.specialty }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="password">Пароль *</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="form-control {% if errors.password %}error{% endif %}"
                        required
                        minlength="8"
                    >
                    {% if errors.password %}
                        <span class="error-message">{{ errors.password }}</span>
                    {% else %}
                        <small class="form-hint">Минимум 8 символов</small>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="password_confirm">Подтверждение пароля *</label>
                    <input 
                        type="password" 
                        id="password_confirm" 
                        name="password_confirm" 
                        class="form-control {% if errors.password_confirm %}error{% endif %}"
                        required
                        minlength="8"
                    >
                    {% if errors.password_confirm %}
                        <span class="error-message">{{ errors.password_confirm }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="registration_key">Регистрационный ключ *</label>
                    <input 
                        type="text" 
                        id="registration_key" 
                        name="registration_key" 
                        class="form-control {% if errors.registration_key %}error{% endif %}"
                        value="{{ form_data.registration_key|default:'' }}"
                        placeholder="Введите регистрационный ключ"
                        required
                        style="text-transform: uppercase;"
                    >
                    {% if errors.registration_key %}
                        <span class="error-message">{{ errors.registration_key }}</span>
                    {% else %}
                        <small class="form-hint">Получите ключ у администратора больницы</small>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="hospital">Больница</label>
                    <select 
                        id="hospital" 
                        name="hospital" 
                        class="form-control"
                    >
                        <option value="">-- Выберите больницу (необязательно) --</option>
                        {% for hospital in hospitals %}
                            <option value="{{ hospital.id }}" {% if form_data.hospital == hospital.id|stringformat:"s" %}selected{% endif %}>
                                {{ hospital.name }}{% if hospital.city %} ({{ hospital.city }}){% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <input type="hidden" name="role" value="doctor">
                
                <button type="submit" class="btn btn-primary btn-block">Зарегистрироваться</button>
            </form>
            
            <div class="register-footer">
                <p>Уже есть аккаунт? <a href="{% url 'admin:index' %}">Войти</a></p>
            </div>
        </div>
    </div>
</div>

<script>
// Автоматическое преобразование регистрационного ключа в верхний регистр
document.addEventListener('DOMContentLoaded', function() {
    const keyInput = document.getElementById('registration_key');
    if (keyInput) {
        keyInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });
    }
});
</script>
{% endblock %}

